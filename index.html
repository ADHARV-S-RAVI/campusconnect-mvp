<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CampusConnect - Your Academic Task Marketplace</title>
    <meta name="description" content="CampusConnect: The ultimate platform for college students to get academic help and earn money by completing tasks like assignments, notes, reports, and PPTs within their college community.">
    <meta name="keywords" content="college students, academic help, assignments, notes, reports, PPTs, earn money, student jobs, campus tasks, peer help, university, student platform">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.yourstartup.com/">
    <meta property="og:title" content="CampusConnect - Your Academic Task Marketplace">
    <meta property="og:description" content="CampusConnect: The ultimate platform for college students to get academic help and earn money by completing tasks like assignments, notes, reports, and PPTs within their college community.">
    <meta property="og:image" content="https://placehold.co/1200x630/60A5FA/FFFFFF?text=CampusConnect">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://www.yourstartup.com/">
    <meta property="twitter:title" content="CampusConnect - Your Academic Task Marketplace">
    <meta property="twitter:description" content="CampusConnect: The ultimate platform for college students to get academic help and earn money by completing tasks like assignments, notes, reports, and PPTs within their college community.">
    <meta property="twitter:image" content="https://placehold.co/1200x630/60A5FA/FFFFFF?text=CampusConnect">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #334155;
            line-height: 1.6;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e2e8f0;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        .page-section {
            display: none;
        }
        .page-section.active {
            display: block;
        }
        .sidebar-link.active {
            background-color: #e2e8f0;
            border-left: 4px solid #4f46e5;
            color: #4f46e5;
            font-weight: 700;
        }
        .dashboard-view.hidden {
            display: none;
        }
        .upi-container {
            border: 2px dashed #4f46e5;
            padding: 1rem;
            border-radius: 0.5rem;
            background-color: #eef2ff;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Header/Navigation -->
    <header class="bg-white shadow-sm py-4 px-6 fixed w-full z-10">
        <div class="container mx-auto flex justify-between items-center">
            <!-- Logo and Site Title -->
            <div class="flex items-center space-x-4">
                <img src="https://i.ibb.co/Sw8dBpGk/Picsart-25-08-08-11-16-46-242.png" alt="CampusConnect Logo" class="w-12 h-12 rounded-full">
                <a href="#" id="home-link" class="text-2xl font-bold text-indigo-600">CampusConnect</a>
            </div>
            <nav>
                <button id="logout-button" class="hidden bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-full transition duration-300 ease-in-out">Logout</button>
            </nav>
        </div>
    </header>

    <main class="pt-20"> <!-- Padding top to account for fixed header -->

        <!-- Landing Page Section -->
        <section id="landing-page" class="page-section active">
            <!-- Hero Section -->
            <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white py-20 px-6 text-center rounded-b-3xl shadow-lg">
                <div class="container mx-auto max-w-4xl">
                    <h1 class="text-4xl md:text-5xl font-extrabold leading-tight mb-4">
                        Unlock Your Campus Potential: Get Help, Get Paid!
                    </h1>
                    <p class="text-lg md:text-xl mb-8 opacity-90">
                        CampusConnect is your peer-to-peer marketplace for academic tasks.
                        Request assignments, notes, PPTs, or offer your skills to earn money, all within your college!
                    </p>
                    <button id="landing-cta-button" class="bg-white text-indigo-700 hover:bg-indigo-100 font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105">
                        Join CampusConnect Now!
                    </button>
                </div>
            </div>

            <!-- How It Works Section -->
            <div id="how-it-works" class="py-16 px-6 bg-white">
                <div class="container mx-auto max-w-5xl text-center">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-12">How CampusConnect Works</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
                        <!-- Step 1 -->
                        <div class="bg-blue-50 p-8 rounded-xl shadow-md transform hover:scale-105 transition duration-300 ease-in-out">
                            <div class="text-indigo-500 mb-4">
                                <svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                            </div>
                            <h3 class="text-xl font-semibold text-gray-700 mb-3">1. Post a Task</h3>
                            <p class="text-gray-600">Need help with an assignment, notes, report, or PPT? Post your task with details and your offer price. Even handwritten assignments are welcome!</p>
                        </div>
                        <!-- Step 2 -->
                        <div class="bg-green-50 p-8 rounded-xl shadow-md transform hover:scale-105 transition duration-300 ease-in-out">
                            <div class="text-green-500 mb-4">
                                <svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            </div>
                            <h3 class="text-xl font-semibold text-gray-700 mb-3">2. Accept & Complete</h3>
                            <p class="text-gray-600">Students from your college can browse tasks, accept what they can do, and complete the work. Payments are held securely until completion.</p>
                        </div>
                        <!-- Step 3 -->
                        <div class="bg-purple-50 p-8 rounded-xl shadow-md transform hover:scale-105 transition duration-300 ease-in-out">
                            <div class="text-purple-500 mb-4">
                                <svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                            </div>
                            <h3 class="text-xl font-semibold text-gray-700 mb-3">3. Get Paid / Get Done</h3>
                            <p class="text-gray-600">Once the task is confirmed, the payment is released to the task-taker. Get your academic work done efficiently, or earn extra cash!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Creator Section (Adharv S Ravi) -->
            <div id="creator-section" class="py-16 px-6 bg-gray-100">
                <div class="container mx-auto max-w-5xl text-center">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-12">Meet the Creator</h2>
                    <div class="bg-white p-8 rounded-xl shadow-md border-t-4 border-indigo-500 max-w-xl mx-auto">
                        <!-- Correctly linked public image URL -->
                        <img src="https://i.ibb.co/rGr1xtPn/Whats-App-Image-2025-08-07-at-12-59-07-f5ec3f42.jpg" alt="Adharv S Ravi" class="w-32 h-32 rounded-full mx-auto mb-4 border-4 border-indigo-500 object-cover">
                        <h3 class="text-2xl font-semibold text-gray-700 mb-2">Adharv S Ravi</h3>
                        <p class="text-gray-600 mb-4">
                            Sapthagiri NPS University student, 2nd Year (2025)
                        </p>
                        <p class="text-gray-500 italic">
                            "Driven by a passion to build tools that empower the student community, I created CampusConnect to bridge the gap between students needing help and those ready to provide it."
                        </p>
                    </div>
                </div>
            </div>

            <!-- Benefits Section -->
            <div class="py-16 px-6 bg-gray-50">
                <div class="container mx-auto max-w-5xl text-center">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-12">Why CampusConnect?</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                        <!-- Benefit 1: For Requesters -->
                        <div class="bg-white p-8 rounded-xl shadow-md border-t-4 border-indigo-500">
                            <h3 class="text-2xl font-semibold text-gray-700 mb-4">For Students Needing Help</h3>
                            <ul class="text-left text-gray-600 space-y-3">
                                <li class="flex items-start">
                                    <svg class="w-6 h-6 text-indigo-500 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                                    <p><strong>Save Time & Stress:</strong> Delegate academic tasks and focus on what matters most.</p>
                                </li>
                                <li class="flex items-start">
                                    <svg class="w-6 h-6 text-indigo-500 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                                    <p><strong>Reliable Help:</strong> Get assistance from verified students within your own college.</p>
                                </li>
                                <li class="flex items-start">
                                    <svg class="w-6 h-6 text-indigo-500 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                                    <p><strong>Secure Payments:</strong> Your payment is held until you confirm the work is complete.</p>
                                </li>
                            </ul>
                        </div>
                        <!-- Benefit 2: For Task Takers -->
                        <div class="bg-white p-8 rounded-xl shadow-md border-t-4 border-purple-500">
                            <h3 class="text-2xl font-semibold text-gray-700 mb-4">For Students Who Want to Earn</h3>
                            <ul class="text-left text-gray-600 space-y-3">
                                <li class="flex items-start">
                                    <svg class="w-6 h-6 text-purple-500 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                                    <p><strong>Earn Extra Cash:</strong> Utilize your skills to help peers and get paid for it.</p>
                                </li>
                                <li class="flex items-start">
                                    <svg class="w-6 h-6 text-purple-500 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                                    <p><strong>Flexible Work:</strong> Choose tasks that fit your schedule and expertise.</p>
                                </li>
                                <li class="flex items-start">
                                    <svg class="w-6 h-6 text-purple-500 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                                    <p><strong>Build Your Network:</strong> Connect with other students and seniors in your college.</p>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Testimonials Section (Placeholder) -->
            <div class="py-16 px-6 bg-blue-50">
                <div class="container mx-auto max-w-5xl text-center">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-12">What Students Are Saying</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <p class="italic text-gray-700 mb-4">"CampusConnect saved my semester! Got my report done perfectly and on time."</p>
                            <p class="font-semibold text-indigo-600">- Priya S., Engineering Student</p>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <p class="italic text-gray-700 mb-4">"Earning money by helping juniors with their assignments is so rewarding. Flexible and easy!"</p>
                            <p class="font-semibold text-indigo-600">- Rohan K., Commerce Student</p>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <p class="italic text-gray-700 mb-4">"Finally, a platform that understands student needs. Highly recommend!"</p>
                            <p class="font-semibold text-indigo-600">- Ananya M., Arts Student</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contact/Join Now Section -->
            <div class="py-20 px-6 bg-gradient-to-r from-purple-600 to-indigo-500 text-white text-center rounded-t-3xl shadow-lg">
                <div class="container mx-auto max-w-3xl">
                    <h2 class="text-3xl md:text-4xl font-bold mb-6">Ready to Connect & Conquer Academics?</h2>
                    <p class="text-lg md:text-xl mb-8 opacity-90">
                        Join CampusConnect today and transform your academic journey.
                    </p>
                    <button id="landing-join-button" class="bg-white text-purple-700 hover:bg-purple-100 font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105">
                        Get Started Now!
                    </button>
                </div>
            </div>
        </section>

        <!-- Login/Signup Page Section -->
        <section id="auth-page" class="page-section py-20 px-6">
            <div class="container mx-auto max-w-md bg-white p-8 rounded-xl shadow-lg">
                <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Welcome to CampusConnect</h2>

                <!-- Google Sign-in -->
                <button id="google-signin-button" class="w-full flex items-center justify-center bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 mb-6">
                    <svg class="w-6 h-6 mr-3" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M44.5 20H24V28.5H35.5C34.05 32.5 30.5 35.5 24 35.5C17.5 35.5 12 30 12 23.5C12 17 17.5 11.5 24 11.5C27.5 11.5 30.5 13 32.5 15L38 10C35 7 30 5 24 5C13 5 4 14 4 23.5C4 33 13 42 24 42C35 42 44 33 44.5 23.5V20Z" fill="#4285F4"/>
                        <path d="M24 42C13 42 4 33 4 23.5C4 14 13 5 24 5V11.5C17.5 11.5 12 17 12 23.5C12 30 17.5 35.5 24 35.5C30.5 35.5 34.05 32.5 35.5 28.5H44.5C44 33 35 42 24 42Z" fill="#34A853"/>
                        <path d="M44.5 20H24V28.5H35.5C34.05 32.5 30.5 35.5 24 35.5C17.5 35.5 12 30 12 23.5C12 17 17.5 11.5 24 11.5C27.5 11.5 30.5 13 32.5 15L38 10C35 7 30 5 24 5C13 5 4 14 4 23.5C4 33 13 42 24 42Z" fill="#FBBC05"/>
                        <path d="M44.5 20H24V28.5H35.5C34.05 32.5 30.5 35.5 24 35.5C17.5 35.5 12 30 12 23.5C12 17 17.5 11.5 24 11.5C27.5 11.5 30.5 13 32.5 15L38 10C35 7 30 5 24 5C13 5 4 14 4 23.5C4 33 13 42 24 42Z" fill="#EA4335"/>
                    </svg>
                    Sign in with Google
                </button>

                <div class="relative flex py-5 items-center">
                    <div class="flex-grow border-t border-gray-300"></div>
                    <span class="flex-shrink mx-4 text-gray-500">OR</span>
                    <div class="flex-grow border-t border-gray-300"></div>
                </div>

                <!-- Email/Password Form -->
                <form id="email-auth-form" class="space-y-4">
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700">Email Address</label>
                        <input type="email" id="email" name="email" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                        <input type="password" id="password" name="password" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                    <button type="submit" id="signup-button" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                        Sign Up
                    </button>
                    <button type="button" id="login-button" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 mt-2">
                        Already have an account? Log In
                    </button>
                </form>
                <p id="auth-message" class="text-center text-sm mt-4 text-red-600"></p>
            </div>
        </section>

        <!-- User Onboarding Page Section -->
        <section id="onboarding-page" class="page-section py-20 px-6">
            <div class="container mx-auto max-w-md bg-white p-8 rounded-xl shadow-lg">
                <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Tell Us About Yourself</h2>
                <form id="onboarding-form" class="space-y-6">
                    <div>
                        <label for="fullName" class="block text-sm font-medium text-gray-700">Full Name</label>
                        <input type="text" id="fullName" name="fullName" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="collegeName" class="block text-sm font-medium text-gray-700">College Name</label>
                        <select id="collegeName" name="collegeName" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            <option value="">Select your college</option>
                            <option value="RV College of Engineering">RV College of Engineering</option>
                            <option value="PES University">PES University</option>
                            <option value="BMS College of Engineering">BMS College of Engineering</option>
                            <option value="Christ University">Christ University</option>
                            <option value="MS Ramaiah Institute of Technology">MS Ramaiah Institute of Technology</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div id="other-college-field" class="hidden">
                        <label for="otherCollegeName" class="block text-sm font-medium text-gray-700">Please specify your college</label>
                        <input type="text" id="otherCollegeName" name="otherCollegeName" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="yearSemester" class="block text-sm font-medium text-gray-700">Year/Semester</label>
                            <input type="text" id="yearSemester" name="yearSemester" placeholder="e.g., 3rd Year / 5th Sem" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="branch" class="block text-sm font-medium text-gray-700">Branch</label>
                            <input type="text" id="branch" name="branch" placeholder="e.g., Computer Science" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                    </div>
                    <div>
                        <label for="mobileNumber" class="block text-sm font-medium text-gray-700">Mobile Number (Optional)</label>
                        <input type="tel" id="mobileNumber" name="mobileNumber" placeholder="e.g., +91 9876543210" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                        Complete Profile
                    </button>
                </form>
            </div>
        </section>

        <!-- Dashboard Page Section -->
        <section id="dashboard-page" class="page-section py-20 px-6">
            <div class="flex flex-col md:flex-row h-full md:h-screen mt-10">
                <!-- Sidebar -->
                <aside class="w-full md:w-64 bg-white shadow-md px-6 py-8 space-y-6 flex-shrink-0 mb-8 md:mb-0">
                    <h2 class="text-2xl font-bold text-indigo-600">Dashboard</h2>
                    <nav class="space-y-2">
                        <a href="#" id="sidebar-link-home" class="sidebar-link block text-gray-700 font-medium hover:bg-gray-100 p-2 rounded transition-colors duration-200 ease-in-out active">🏠 Home</a>
                        <a href="#" id="sidebar-link-profile" class="sidebar-link block text-gray-700 font-medium hover:bg-gray-100 p-2 rounded transition-colors duration-200 ease-in-out">👤 My Profile</a>
                        <a href="#" id="sidebar-link-earnings" class="sidebar-link block text-gray-700 font-medium hover:bg-gray-100 p-2 rounded transition-colors duration-200 ease-in-out">💰 Your Journey / Earnings</a>
                        <a href="#" id="sidebar-link-available-tasks" class="sidebar-link block text-gray-700 font-medium hover:bg-gray-100 p-2 rounded transition-colors duration-200 ease-in-out">📋 Tasks Available</a>
                        <a href="#" id="sidebar-link-give-task" class="sidebar-link block text-gray-700 font-medium hover:bg-gray-100 p-2 rounded transition-colors duration-200 ease-in-out">📝 Give Task</a>
                        <a href="#" id="sidebar-link-rewards" class="sidebar-link block text-gray-700 font-medium hover:bg-gray-100 p-2 rounded transition-colors duration-200 ease-in-out">🎁 Rewards</a>
                        <a href="#" id="sidebar-link-payments" class="sidebar-link block text-gray-700 font-medium hover:bg-gray-100 p-2 rounded transition-colors duration-200 ease-in-out">💳 Payment Management</a>
                        <hr />
                        <a href="#" id="sidebar-link-notifications" class="sidebar-link block text-gray-500 text-sm hover:bg-gray-100 p-2 rounded transition-colors duration-200 ease-in-out">🔔 Notifications</a>
                    </nav>
                </aside>

                <!-- Main Content -->
                <div class="flex-1 p-8 overflow-y-auto bg-gray-50 rounded-xl shadow-lg">
                    <!-- Dashboard Content Views -->
                    <div id="dashboard-content-views">
                        <!-- Home View -->
                        <div id="dashboard-home-view" class="dashboard-view">
                            <div class="flex justify-center mb-6">
                                <img src="https://i.ibb.co/tf3M9Qg/home-banner-img.jpg" alt="College India Placeholder" class="w-full h-auto object-contain rounded-xl shadow-md">
                            </div>
                            <div id="user-info-display" class="bg-indigo-50 p-4 rounded-lg shadow-md mb-8 text-center">
                                <p class="text-indigo-800 text-lg">Welcome, <span class="font-semibold" id="dashboard-user-name"></span>!</p>
                                <p class="text-indigo-700 text-sm">College: <span id="dashboard-user-college"></span> | Role: <span id="dashboard-user-role"></span></p>
                                <p class="text-indigo-700 text-sm">Your User ID: <span class="font-mono text-xs" id="dashboard-user-id"></span></p>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">Welcome to Your Dashboard</h3>
                            <p class="text-gray-600 text-center">Use the sidebar on the left to navigate the app.</p>
                        </div>

                        <!-- My Profile View -->
                        <div id="dashboard-profile-view" class="dashboard-view hidden">
                            <div class="flex items-center justify-between mb-6">
                                <button onclick="showDashboardView('dashboard-home-view')" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-full transition-colors duration-200 ease-in-out">← Back</button>
                                <h3 class="text-2xl font-bold text-gray-800 text-center flex-grow">My Profile</h3>
                                <div></div>
                            </div>
                            <div class="bg-white p-8 rounded-xl shadow-sm space-y-6">
                                <div class="flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-8">
                                    <img id="profile-pic" src="https://placehold.co/128x128/9CA3AF/ffffff?text=User" alt="Profile Picture" class="w-32 h-32 rounded-full object-cover border-4 border-indigo-400">
                                    <div class="text-center md:text-left">
                                        <h4 class="text-xl font-bold text-gray-800"><span id="profile-full-name"></span></h4>
                                        <p class="text-gray-600"><span id="profile-email"></span></p>
                                        <p class="text-gray-600">College: <span id="profile-college-name"></span></p>
                                        <p class="text-gray-600">Year/Branch: <span id="profile-year-branch"></span></p>
                                        <p class="text-gray-600">User ID: <span id="profile-user-id" class="font-mono text-sm"></span></p>
                                    </div>
                                </div>
                                <hr>
                                <h4 class="text-xl font-bold text-gray-800 text-center">Your Work History</h4>
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <div class="p-4 bg-indigo-50 rounded-xl shadow-sm">
                                        <h5 class="font-semibold text-gray-700">Posted Tasks</h5>
                                        <div id="profile-posted-tasks" class="mt-2 space-y-2 text-sm text-gray-600"></div>
                                    </div>
                                    <div class="p-4 bg-green-50 rounded-xl shadow-sm">
                                        <h5 class="font-semibold text-gray-700">Completed Tasks</h5>
                                        <div id="profile-completed-tasks" class="mt-2 space-y-2 text-sm text-gray-600"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Your Journey / Earnings View -->
                        <div id="dashboard-earnings-view" class="dashboard-view hidden">
                            <div class="flex items-center justify-between mb-6">
                                <button onclick="showDashboardView('dashboard-home-view')" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-full transition-colors duration-200 ease-in-out">← Back</button>
                                <h3 class="text-2xl font-bold text-gray-800 text-center flex-grow">Your Journey / Earnings</h3>
                                <div></div> <!-- Spacer for alignment -->
                            </div>
                            <div class="bg-white p-6 rounded-xl shadow-sm">
                                <p class="text-gray-600 font-bold mt-4 text-center">Current Balance: <span id="user-balance" class="text-green-600">₹0.00</span></p>
                                <h4 class="text-xl font-bold text-gray-800 mt-6">Your Accepted & Completed Tasks</h4>
                                <div id="accepted-and-completed-tasks" class="mt-4 space-y-4">
                                    <p class="text-center text-gray-500">No accepted or completed tasks yet.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Tasks Available View -->
                        <div id="dashboard-available-tasks-view" class="dashboard-view hidden">
                            <div class="flex items-center justify-between mb-6">
                                <button onclick="showDashboardView('dashboard-home-view')" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-full transition-colors duration-200 ease-in-out">← Back</button>
                                <h3 class="text-2xl font-bold text-gray-800 text-center flex-grow">Available Tasks</h3>
                                <div></div>
                            </div>
                             <div class="flex items-center justify-end mb-4">
                                <div class="flex items-center space-x-2">
                                    <label for="all-college-filter" class="text-gray-700 font-medium">Show All Colleges</label>
                                    <input type="checkbox" id="all-college-filter" class="form-checkbox h-5 w-5 text-indigo-600 rounded">
                                </div>
                            </div>
                            <div id="available-tasks-list" class="space-y-4">
                                <p class="text-center text-gray-600">Loading tasks...</p>
                            </div>
                        </div>
                        
                        <!-- Give Task View -->
                        <div id="dashboard-give-task-view" class="dashboard-view hidden">
                            <div class="flex items-center justify-between mb-6">
                                <button onclick="showDashboardView('dashboard-home-view')" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-full transition-colors duration-200 ease-in-out">← Back</button>
                                <h3 class="text-2xl font-bold text-gray-800 text-center flex-grow">Post a New Task</h3>
                                <div></div>
                            </div>
                            <form id="post-task-form" class="space-y-4 bg-white p-6 rounded-xl shadow-sm">
                                <div>
                                    <label for="taskDescription" class="block text-sm font-medium text-gray-700">Task Description</label>
                                    <textarea id="taskDescription" name="taskDescription" rows="4" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="e.g., Need help with a 10-page report on 'Sustainable Energy', due next week."></textarea>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="taskPrice" class="block text-sm font-medium text-gray-700">Your Offer Price (₹)</label>
                                        <input type="number" id="taskPrice" name="taskPrice" min="50" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="e.g., 250">
                                    </div>
                                    <div>
                                        <label for="taskFormat" class="block text-sm font-medium text-gray-700">Format</label>
                                        <select id="taskFormat" name="taskFormat" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                            <option value="">Select Format</option>
                                            <option value="Assignment">Assignment</option>
                                            <option value="Notes">Notes</option>
                                            <option value="Report">Report</option>
                                            <option value="PPT">PPT (Presentation)</option>
                                            <option value="Senior Guidance">Senior Guidance</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                </div>
                                <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                                    Post Task
                                </button>
                                <p id="post-task-message" class="text-center text-sm mt-4 text-green-600"></p>
                            </form>
                            
                            <h3 class="text-2xl font-bold text-gray-800 mt-12 mb-6 text-center">Your Posted Tasks</h3>
                            <div id="my-posted-tasks" class="space-y-4">
                                <p class="text-center text-gray-600">No tasks posted yet.</p>
                            </div>
                        </div>

                        <!-- Rewards View -->
                        <div id="dashboard-rewards-view" class="dashboard-view hidden">
                             <div class="flex items-center justify-between mb-6">
                                <button onclick="showDashboardView('dashboard-home-view')" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-full transition-colors duration-200 ease-in-out">← Back</button>
                                <h3 class="text-2xl font-bold text-gray-800 text-center flex-grow">Rewards</h3>
                                <div></div>
                            </div>
                            <div class="bg-white p-6 rounded-xl shadow-sm">
                                <p class="text-gray-600 text-center">This section displays your special rewards and coupons.</p>
                                <div id="rewards-content" class="mt-6">
                                    <!-- This will be dynamically populated -->
                                </div>
                            </div>
                        </div>

                        <!-- Payment Management View -->
                        <div id="dashboard-payments-view" class="dashboard-view hidden">
                            <div class="flex items-center justify-between mb-6">
                                <button onclick="showDashboardView('dashboard-home-view')" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-full transition-colors duration-200 ease-in-out">← Back</button>
                                <h3 class="text-2xl font-bold text-gray-800 text-center flex-grow">Payment Management</h3>
                                <div></div>
                            </div>
                            <div class="bg-white p-6 rounded-xl shadow-sm">
                                <p class="text-gray-600 text-center">Here you would manage your payment methods and withdraw your earnings.</p>
                                <p class="text-center text-gray-800 font-bold mt-4">Current Balance: <span id="payment-balance" class="text-green-600">₹0.00</span></p>
                                
                                <div class="mt-6 upi-container">
                                    <p class="text-sm font-semibold text-gray-700">Simulated UPI Gateway</p>
                                    <p class="text-sm text-gray-600">Click on an app below to initiate a withdrawal of your balance.</p>
                                    <div class="mt-4 flex justify-around items-center">
                                        <a href="#" class="upi-link" data-app="gpay">
                                            <img src="https://upload.wikimedia.org/wikipedia/commons/b/b3/Google_Pay_icon_%282020%29.svg" alt="Google Pay" class="w-16 h-16">
                                        </a>
                                        <a href="#" class="upi-link" data-app="phonepe">
                                            <img src="https://upload.wikimedia.org/wikipedia/commons/e/e1/PhonePe_Logo.svg" alt="PhonePe" class="w-16 h-16">
                                        </a>
                                        <a href="#" class="upi-link" data-app="paytm">
                                            <img src="https://upload.wikimedia.org/wikipedia/commons/d/d4/Paytm_Logo.png" alt="Paytm" class="w-16 h-16">
                                        </a>
                                    </div>
                                    <p class="text-xs text-red-500 mt-4 text-center">**Disclaimer:** This is a **simulated** payment. In a real application, this would be a secure backend process.</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Notifications View -->
                        <div id="dashboard-notifications-view" class="dashboard-view hidden">
                             <div class="flex items-center justify-between mb-6">
                                <button onclick="showDashboardView('dashboard-home-view')" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-full transition-colors duration-200 ease-in-out">← Back</button>
                                <h3 class="text-2xl font-bold text-gray-800 text-center flex-grow">Notifications</h3>
                                <div></div>
                            </div>
                            <div class="bg-white p-6 rounded-xl shadow-sm">
                                <p class="text-gray-600 text-center">You have no new notifications.</p>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
        </section>

        <!-- Global Message Box -->
        <div id="message-box" class="fixed bottom-4 right-4 bg-gray-800 text-white p-4 rounded-lg shadow-xl hidden z-50">
            <p id="message-content"></p>
            <button id="message-close-button" class="absolute top-1 right-2 text-white text-lg font-bold">&times;</button>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-gray-300 py-10 px-6 text-center">
        <div class="container mx-auto max-w-5xl">
            <p class="mb-4">&copy; 2025 CampusConnect. All rights reserved.</p>
            <p class="text-sm">
                <a href="#" class="hover:text-white mx-2">Privacy Policy</a> |
                <a href="#" class="hover:text-white mx-2">Terms of Service</a>
            </p>
            <p class="text-sm mt-4">
                Contact us: <a href="mailto:info@campusconnect.com" class="hover:text-white">info@campusconnect.com</a>
                <span class="mx-2">|</span> Follow us on <a href="#" class="hover:text-white">Social Media</a> (Coming Soon!)
            </p>
        </div>
    </footer>

    <!-- Firebase SDKs -->
<script>
  const __firebase_config = JSON.stringify({
    apiKey: "AIzaSyCiH_Oa7hzN0WL2e3391M-1LaIf0jzmPDA",
    authDomain: "clglink-37e05.firebaseapp.com",
    projectId: "clglink-37e05",
    storageBucket: "clglink-37e05.appspot.com",
    messagingSenderId: "150826464811",
    appId: "1:150826464811:web:ab87ebcdba820f98ca1c6e",
    measurementId: "G-E3FL29DWML"
  });
</script>

<script type="module">
        // Firebase SDK imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import {
            getAuth,
            signInWithPopup,
            GoogleAuthProvider,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signOut,
            onIdTokenChanged,
            signInWithCustomToken,
            signInAnonymously
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import {
            getFirestore,
            doc,
            getDoc,
            setDoc,
            addDoc,
            collection,
            query,
            where,
            onSnapshot,
            serverTimestamp,
            updateDoc
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Firebase Configuration & Initialization ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app;
        let auth;
        let db;
        let currentUserData = null;

        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            console.log("Firebase initialized successfully.");
        } catch (error) {
            console.error("Error initializing Firebase:", error);
        }

        // --- Global UI Elements ---
        let landingPage, authPage, onboardingPage, dashboardPage;
        let logoutButton, homeLink, messageBox, messageContent, messageCloseButton;
        let googleSignInButton, emailAuthForm, emailInput, passwordInput, signupButton, loginButton, authMessage;
        let onboardingForm, collegeNameSelect, otherCollegeField, otherCollegeNameInput;
        let dashboardUserName, dashboardUserCollege, dashboardUserRole, dashboardUserId;
        let postTaskForm, myPostedTasks, availableTasksList;
        let userBalanceSpan, paymentBalanceSpan, acceptedAndCompletedTasksList;
        let allCollegeFilter, profileFullName, profileEmail, profileCollege, profileYearBranch, profileUserId, profilePostedTasks, profileCompletedTasks;

        // --- Message Box Functions ---
        function showMessage(message, type = "info") {
            if (messageContent && messageBox) {
                messageContent.textContent = message;
                messageBox.className = `fixed bottom-4 right-4 p-4 rounded-lg shadow-xl z-50 transition-all duration-300 ease-in-out transform translate-y-0`;
                if (type === "error") {
                    messageBox.classList.add('bg-red-600', 'text-white');
                } else if (type === "success") {
                    messageBox.classList.add('bg-green-600', 'text-white');
                } else {
                    messageBox.classList.add('bg-gray-800', 'text-white');
                }
                messageBox.classList.remove('hidden');
                setTimeout(() => {
                    hideMessage();
                }, 5000);
            }
        }
        function hideMessage() {
            if (messageBox) {
                messageBox.classList.add('hidden');
            }
        }

        // --- Page Navigation Logic ---
        function showPage(pageId) {
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            window.scrollTo(0, 0);
        }

        // --- Dashboard View Switching Logic ---
        function showDashboardView(viewId) {
            document.querySelectorAll('.dashboard-view').forEach(view => {
                view.classList.add('hidden');
            });
            document.getElementById(viewId).classList.remove('hidden');
            
            document.querySelectorAll('.sidebar-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Add active class to the corresponding sidebar link
            const linkId = `sidebar-link-${viewId.replace('dashboard-', '').replace('-view', '')}`;
            const activeLink = document.getElementById(linkId);
            if (activeLink) {
                activeLink.classList.add('active');
            }
            // Update the balance in payments view whenever we show it
            if (viewId === 'dashboard-payments-view' || viewId === 'dashboard-earnings-view') {
                 if (paymentBalanceSpan && userBalanceSpan && currentUserData) {
                    const balance = (currentUserData.balance || 0).toFixed(2);
                    userBalanceSpan.textContent = `₹${balance}`;
                    paymentBalanceSpan.textContent = `₹${balance}`;
                }
            }
            if (viewId === 'dashboard-profile-view') {
                if (currentUserData) {
                    renderProfile(currentUserData);
                }
            }
        }

        // --- Firebase Auth State Listener ---
        onIdTokenChanged(auth, async (user) => {
            if (user && user.uid) {
                console.log("ID token ready for user:", user.uid);
                if (logoutButton) logoutButton.classList.remove('hidden');
                const userDocRef = doc(db, "users", user.uid);
                try {
                    const userDocSnap = await getDoc(userDocRef);
                    if (userDocSnap.exists()) {
                        currentUserData = userDocSnap.data();
                        renderDashboard(currentUserData);
                        showPage('dashboard-page');
                    } else {
                        showPage('onboarding-page');
                    }
                } catch (error) {
                    console.error("Error fetching user document:", error);
                    showMessage(`Error loading profile: ${error.message}`, "error");
                }
            } else {
                if (logoutButton) logoutButton.classList.add('hidden');
                currentUserData = null;
                showPage('landing-page');
            }
        });

        // --- Initial Auth & Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            landingPage = document.getElementById('landing-page');
            authPage = document.getElementById('auth-page');
            onboardingPage = document.getElementById('onboarding-page');
            dashboardPage = document.getElementById('dashboard-page');
            logoutButton = document.getElementById('logout-button');
            homeLink = document.getElementById('home-link');
            messageBox = document.getElementById('message-box');
            messageContent = document.getElementById('message-content');
            messageCloseButton = document.getElementById('message-close-button');
            googleSignInButton = document.getElementById('google-signin-button');
            emailAuthForm = document.getElementById('email-auth-form');
            emailInput = document.getElementById('email');
            passwordInput = document.getElementById('password');
            signupButton = document.getElementById('signup-button');
            loginButton = document.getElementById('login-button');
            authMessage = document.getElementById('auth-message');
            onboardingForm = document.getElementById('onboarding-form');
            collegeNameSelect = document.getElementById('collegeName');
            otherCollegeField = document.getElementById('other-college-field');
            otherCollegeNameInput = document.getElementById('otherCollegeName');
            dashboardUserName = document.getElementById('dashboard-user-name');
            dashboardUserCollege = document.getElementById('dashboard-user-college');
            dashboardUserRole = document.getElementById('dashboard-user-role');
            dashboardUserId = document.getElementById('dashboard-user-id');
            postTaskForm = document.getElementById('post-task-form');
            myPostedTasks = document.getElementById('my-posted-tasks');
            availableTasksList = document.getElementById('available-tasks-list');
            acceptedAndCompletedTasksList = document.getElementById('accepted-and-completed-tasks');
            userBalanceSpan = document.getElementById('user-balance');
            paymentBalanceSpan = document.getElementById('payment-balance');
            allCollegeFilter = document.getElementById('all-college-filter');
            profileFullName = document.getElementById('profile-full-name');
            profileEmail = document.getElementById('profile-email');
            profileCollege = document.getElementById('profile-college-name');
            profileYearBranch = document.getElementById('profile-year-branch');
            profileUserId = document.getElementById('profile-user-id');
            profilePostedTasks = document.getElementById('profile-posted-tasks');
            profileCompletedTasks = document.getElementById('profile-completed-tasks');
            
            // Sidebar link event listeners
            document.getElementById('sidebar-link-home').addEventListener('click', () => showDashboardView('dashboard-home-view'));
            document.getElementById('sidebar-link-profile').addEventListener('click', () => showDashboardView('dashboard-profile-view'));
            document.getElementById('sidebar-link-earnings').addEventListener('click', () => showDashboardView('dashboard-earnings-view'));
            document.getElementById('sidebar-link-available-tasks').addEventListener('click', () => showDashboardView('dashboard-available-tasks-view'));
            document.getElementById('sidebar-link-give-task').addEventListener('click', () => showDashboardView('dashboard-give-task-view'));
            document.getElementById('sidebar-link-rewards').addEventListener('click', () => showDashboardView('dashboard-rewards-view'));
            document.getElementById('sidebar-link-payments').addEventListener('click', () => showDashboardView('dashboard-payments-view'));
            document.getElementById('sidebar-link-notifications').addEventListener('click', () => showDashboardView('dashboard-notifications-view'));

            // Onboarding form conditional field
            if (collegeNameSelect) {
                collegeNameSelect.addEventListener('change', () => {
                    if (collegeNameSelect.value === 'Other') {
                        otherCollegeField.classList.remove('hidden');
                        otherCollegeNameInput.setAttribute('required', 'true');
                    } else {
                        otherCollegeField.classList.add('hidden');
                        otherCollegeNameInput.removeAttribute('required');
                    }
                });
            }
            // Filter toggle listener
            if (allCollegeFilter) {
                allCollegeFilter.addEventListener('change', () => {
                    if (currentUserData) {
                        fetchAvailableTasks(currentUserData.college);
                    }
                });
            }

            // UPI link click handler
            document.querySelectorAll('.upi-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (currentUserData && currentUserData.balance > 0) {
                        // This is a simulated UPI deep link
                        const upiId = "adharvravi@oksbi";
                        const amount = currentUserData.balance.toFixed(2);
                        const transactionId = `T${Date.now()}`;
                        const upiLink = `upi://pay?pa=${upiId}&pn=Adharv%20S%20Ravi&mc=0000&tid=${transactionId}&tr=${transactionId}&am=${amount}&cu=INR&url=https://www.campusconnect.com`;
                        
                        // Open the link to simulate payment app
                        window.open(upiLink, '_blank');
                        
                        // Simulate withdrawal from balance
                        // Note: In a real app, this would happen after a successful transaction notification from the payment gateway
                        const userDocRef = doc(db, "users", currentUserData.userId);
                        updateDoc(userDocRef, { balance: 0 });
                        
                        showMessage("Simulated withdrawal initiated. Check your payment app!", "success");
                    } else {
                        showMessage("Your balance is ₹0.00. No funds to withdraw.", "info");
                    }
                });
            });

            // Initial sign-in with custom token if available
            if (initialAuthToken) {
                signInWithCustomToken(auth, initialAuthToken).catch((error) => {
                    console.error("Error signing in with custom token:", error);
                });
            } else {
                signInAnonymously(auth).catch((anonError) => {
                    console.error("Error signing in anonymously:", anonError);
                });
            }
            if (messageCloseButton) {
                messageCloseButton.addEventListener('click', hideMessage);
            }
            if (document.getElementById('landing-cta-button')) {
                document.getElementById('landing-cta-button').addEventListener('click', () => showPage('auth-page'));
            }
            if (document.getElementById('landing-join-button')) {
                document.getElementById('landing-join-button').addEventListener('click', () => showPage('auth-page'));
            }
            if (homeLink) {
                homeLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (auth.currentUser) {
                        showPage('dashboard-page');
                        showDashboardView('dashboard-home-view');
                    } else {
                        showPage('landing-page');
                    }
                });
            }
            if (googleSignInButton) {
                googleSignInButton.addEventListener('click', async () => {
                    try {
                        const provider = new GoogleAuthProvider();
                        await signInWithPopup(auth, provider);
                    } catch (error) {
                        console.error("Google Sign-in Error:", error);
                        if (authMessage) authMessage.textContent = `Error: ${error.message}`;
                        showMessage(`Google Sign-in failed: ${error.message}`, "error");
                    }
                });
            }
            if (signupButton) {
                signupButton.addEventListener('click', async (e) => {
                    e.preventDefault();
                    const email = emailInput.value;
                    const password = passwordInput.value;
                    if (!email || !password) {
                        if (authMessage) authMessage.textContent = "Please enter email and password.";
                        return;
                    }
                    try {
                        await createUserWithEmailAndPassword(auth, email, password);
                        if (authMessage) authMessage.textContent = "Signed up successfully! Redirecting...";
                        showMessage("Signed up successfully! Welcome.", "success");
                    } catch (error) {
                        console.error("Email Sign-up Error:", error);
                        if (authMessage) authMessage.textContent = `Error: ${error.message}`;
                        showMessage(`Sign up failed: ${error.message}`, "error");
                    }
                });
            }
            if (loginButton) {
                loginButton.addEventListener('click', async (e) => {
                    e.preventDefault();
                    const email = emailInput.value;
                    const password = passwordInput.value;
                    if (!email || !password) {
                        if (authMessage) authMessage.textContent = "Please enter email and password.";
                        return;
                    }
                    try {
                        await signInWithEmailAndPassword(auth, email, password);
                        if (authMessage) authMessage.textContent = "Logged in successfully! Redirecting...";
                        showMessage("Logged in successfully! Welcome back.", "success");
                    } catch (error) {
                        console.error("Email Login Error:", error);
                        if (authMessage) authMessage.textContent = `Error: ${error.message}`;
                        showMessage(`Login failed: ${error.message}`, "error");
                    }
                });
            }
            if (logoutButton) {
                logoutButton.addEventListener('click', async () => {
                    try {
                        await signOut(auth);
                        showMessage("Logged out successfully.", "info");
                    } catch (error) {
                        console.error("Logout Error:", error);
                        showMessage(`Logout failed: ${error.message}`, "error");
                    }
                });
            }
            if (onboardingForm) {
                onboardingForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const user = auth.currentUser;
                    if (!user) {
                        showMessage("You must be logged in to complete your profile.", "error");
                        return;
                    }
                    const fullName = document.getElementById('fullName').value;
                    let collegeName = collegeNameSelect.value;
                    const yearSemester = document.getElementById('yearSemester').value;
                    const branch = document.getElementById('branch').value;
                    const mobileNumber = document.getElementById('mobileNumber').value;

                    // Use the 'other' college name if specified
                    if (collegeName === 'Other') {
                        collegeName = otherCollegeNameInput.value;
                    }

                    if (!fullName || !collegeName) {
                        showMessage("Please fill in all required fields (Full Name, College).", "error");
                        return;
                    }
                    const userProfile = {
                        fullName,
                        college: collegeName,
                        yearSemester,
                        branch,
                        mobile: mobileNumber,
                        balance: 0,
                        createdAt: serverTimestamp(),
                        userId: user.uid
                    };
                    try {
                        const userDocRef = doc(db, "users", user.uid);
                        await setDoc(userDocRef, userProfile, { merge: true });
                        currentUserData = userProfile;
                        showMessage("Profile saved successfully! Redirecting to dashboard.", "success");
                        renderDashboard(currentUserData);
                        showPage('dashboard-page');
                    } catch (error) {
                        console.error("Error saving user profile:", error);
                        showMessage(`Error saving profile: ${error.message}`, "error");
                    }
                });
            }
            if (postTaskForm) {
                postTaskForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const user = auth.currentUser;
                    if (!user || !currentUserData) {
                        showMessage("You must be logged in and have a profile to post a task.", "error");
                        return;
                    }
                    const taskDescription = document.getElementById('taskDescription').value;
                    const taskPrice = parseFloat(document.getElementById('taskPrice').value);
                    const taskFormat = document.getElementById('taskFormat').value;
                    if (!taskDescription || !taskPrice || !taskFormat) {
                        showMessage("Please fill in all task details.", "error");
                        return;
                    }
                    const platformFee = 10;
                    const workerReceives = taskPrice - platformFee;
                    const taskData = {
                        postedByUid: user.uid,
                        college: currentUserData.college,
                        description: taskDescription,
                        price: taskPrice,
                        workerReceives: workerReceives,
                        format: taskFormat,
                        status: 'open',
                        createdAt: serverTimestamp()
                    };
                    try {
                        await addDoc(collection(db, "tasks"), taskData);
                        postTaskForm.reset();
                        showMessage("Task posted successfully!", "success");
                    } catch (error) {
                        console.error("Error posting task:", error);
                        showMessage(`Error posting task: ${error.message}`, "error");
                    }
                });
            }
        });

        function renderDashboard(userData) {
            if (dashboardUserName) {
                dashboardUserName.textContent = userData.fullName || 'Student';
                dashboardUserCollege.textContent = userData.college || 'N/A';
                dashboardUserRole.textContent = userData.role ? (userData.role === 'request' ? 'Requester' : 'Worker') : 'Not Set';
                dashboardUserId.textContent = userData.userId;
            }
            
            // Set up real-time listeners for dashboard views
            fetchMyPostedTasks(userData.userId);
            fetchAvailableTasks(userData.college);
            fetchUserBalance(userData.userId);
            fetchMyAcceptedTasks(userData.userId); 
            fetchRewards(userData.createdAt);

            // Show the default home view
            showDashboardView('dashboard-home-view');
        }
        
        function renderProfile(userData) {
            if (profileFullName) {
                profileFullName.textContent = userData.fullName || 'Student';
                profileEmail.textContent = auth.currentUser.email || 'N/A';
                profileCollege.textContent = userData.college || 'N/A';
                profileYearBranch.textContent = `${userData.yearSemester || 'N/A'} / ${userData.branch || 'N/A'}`;
                profileUserId.textContent = userData.userId;
            }
            
            // Fetch and render posted tasks for profile view
            const postedQuery = query(collection(db, "tasks"), where("postedByUid", "==", userData.userId));
            onSnapshot(postedQuery, (snapshot) => {
                if (profilePostedTasks) {
                    profilePostedTasks.innerHTML = '';
                    if (snapshot.empty) {
                         profilePostedTasks.innerHTML = '<p>No tasks posted.</p>';
                    } else {
                        snapshot.forEach(doc => {
                            const task = doc.data();
                            profilePostedTasks.innerHTML += `<p class="text-gray-700 font-medium">${task.description} <span class="text-sm font-normal text-gray-500">(${task.status})</span></p>`;
                        });
                    }
                }
            });

            // Fetch and render completed tasks for profile view
            const completedQuery = query(collection(db, "tasks"), where("acceptedByUid", "==", userData.userId), where("status", "==", "completed"));
            onSnapshot(completedQuery, (snapshot) => {
                if (profileCompletedTasks) {
                    profileCompletedTasks.innerHTML = '';
                    if (snapshot.empty) {
                        profileCompletedTasks.innerHTML = '<p>No tasks completed.</p>';
                    } else {
                        snapshot.forEach(doc => {
                            const task = doc.data();
                            profileCompletedTasks.innerHTML += `<p class="text-gray-700 font-medium">${task.description} <span class="text-sm font-normal text-gray-500">(Earned ₹${task.workerReceives})</span></p>`;
                        });
                    }
                }
            });
        }
        
        function fetchUserBalance(userId) {
            const userDocRef = doc(db, "users", userId);
            onSnapshot(userDocRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    const balance = data.balance || 0;
                    if (userBalanceSpan) userBalanceSpan.textContent = `₹${balance.toFixed(2)}`;
                    if (paymentBalanceSpan) paymentBalanceSpan.textContent = `₹${balance.toFixed(2)}`;
                    currentUserData.balance = balance;
                }
            }, (error) => {
                console.error("Error fetching user balance:", error);
            });
        }
        
        function fetchRewards(createdAt) {
            const rewardsContent = document.getElementById('rewards-content');
            if (!rewardsContent) return;

            rewardsContent.innerHTML = ''; // Clear previous content
            
            if (createdAt) {
                const now = new Date();
                const createdDate = createdAt.toDate();
                const daysSinceJoined = Math.floor((now - createdDate) / (1000 * 60 * 60 * 24));

                if (daysSinceJoined <= 7) {
                    rewardsContent.innerHTML += `
                        <div class="bg-green-100 p-4 rounded-lg shadow-sm border-2 border-green-300">
                            <h4 class="text-xl font-bold text-green-700">🎉 Welcome Coupon! 🎉</h4>
                            <p class="text-green-800 mt-2">As a new user, you get a special <strong>15% coupon</strong> on your first task!</p>
                            <p class="text-green-800 mt-2 font-mono bg-green-200 p-2 rounded-md">NEWUSER15</p>
                            <p class="text-sm text-gray-600 mt-2">Valid for 7 days from your sign-up date.</p>
                        </div>
                    `;
                } else {
                    rewardsContent.innerHTML += `<p class="text-center text-gray-600">No active coupons at this time. Check back later!</p>`;
                }
            } else {
                rewardsContent.innerHTML += `<p class="text-center text-gray-600">User data not available.</p>`;
            }
        }
        
        function fetchMyAcceptedTasks(userId) {
            const q = query(
                collection(db, "tasks"),
                where("acceptedByUid", "==", userId)
            );
            onSnapshot(q, (snapshot) => {
                if (acceptedAndCompletedTasksList) {
                    acceptedAndCompletedTasksList.innerHTML = '';
                    if (snapshot.empty) {
                        acceptedAndCompletedTasksList.innerHTML = '<p class="text-center text-gray-500">You have no accepted or completed tasks yet.</p>';
                    } else {
                         snapshot.forEach((doc) => {
                            const task = doc.data();
                            const taskCard = document.createElement('div');
                            taskCard.className = `p-6 rounded-lg shadow-sm border-l-4 mb-4 ${task.status === 'completed' ? 'bg-green-50 border-green-400' : 'bg-yellow-50 border-yellow-400'}`;
                            taskCard.innerHTML = `
                                <h4 class="text-lg font-semibold text-gray-800">${task.description}</h4>
                                <p class="text-gray-600">You will earn: <span class="font-bold text-green-700">₹${task.workerReceives}</span></p>
                                <p class="text-gray-600">Status: <span class="font-medium text-blue-700">${task.status.toUpperCase()}</span></p>
                                <p class="text-gray-500 text-sm mt-2">Accepted on: ${task.acceptedAt ? new Date(task.acceptedAt.toDate()).toLocaleDateString() : 'N/A'}</p>
                            `;
                            acceptedAndCompletedTasksList.appendChild(taskCard);
                        });
                    }
                }
            }, (error) => {
                console.error("Error fetching accepted/completed tasks:", error);
            });
        }
        
        function fetchMyPostedTasks(userId) {
            const q = query(collection(db, "tasks"), where("postedByUid", "==", userId));
            onSnapshot(q, async (snapshot) => {
                if (myPostedTasks) {
                    myPostedTasks.innerHTML = '';
                    if (snapshot.empty) {
                        myPostedTasks.innerHTML = '<p class="text-center text-gray-600">No tasks posted yet.</p>';
                    } else {
                        for (const docSnapshot of snapshot.docs) {
                            const task = docSnapshot.data();
                            const taskId = docSnapshot.id;
                            let acceptedByName = "N/A";
                            if (task.acceptedByUid) {
                                try {
                                    const acceptedUserDoc = await getDoc(doc(db, "users", task.acceptedByUid));
                                    if (acceptedUserDoc.exists()) {
                                        acceptedByName = acceptedUserDoc.data().fullName || "A student";
                                    }
                                } catch (error) {
                                    console.error("Error fetching accepted user name:", error);
                                }
                            }

                            const taskCard = `
                                <div class="bg-gray-50 p-6 rounded-lg shadow-sm border-l-4 ${task.status === 'open' ? 'border-indigo-400' : 'border-green-400'}">
                                    <h4 class="text-lg font-semibold text-gray-800">${task.description}</h4>
                                    <p class="text-gray-600">Format: ${task.format}</p>
                                    <p class="text-gray-600">Offer: ₹${task.price} (Worker gets ₹${task.workerReceives})</p>
                                    <p class="text-gray-600">Status: <span class="font-medium text-blue-700">${task.status.toUpperCase()}</span></p>
                                    ${task.status !== 'open' ? `<p class="text-gray-600">Accepted by: ${acceptedByName}</p>` : ''}
                                    <p class="text-gray-500 text-sm mt-2">Posted on: ${task.createdAt ? new Date(task.createdAt.toDate()).toLocaleDateString() : 'N/A'}</p>
                                    ${task.status === 'accepted' ? `<button data-task-id="${taskId}" class="complete-task-button mt-4 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 ease-in-out">Mark as Complete</button>` : ''}
                                </div>
                            `;
                            myPostedTasks.innerHTML += taskCard;
                        }
                        
                        document.querySelectorAll('.complete-task-button').forEach(button => {
                            button.addEventListener('click', async (event) => {
                                const taskId = event.target.dataset.taskId;
                                await completeTask(taskId);
                            });
                        });
                    }
                }
            }, (error) => {
                console.error("Error fetching my posted tasks:", error);
                showMessage(`Error loading your tasks: ${error.message}`, "error");
            });
        }
        
        function fetchAvailableTasks(college) {
            const showAll = allCollegeFilter ? allCollegeFilter.checked : false;
            let q;
            if (showAll) {
                q = query(collection(db, "tasks"), where("status", "==", "open"));
            } else {
                q = query(
                    collection(db, "tasks"),
                    where("status", "==", "open"),
                    where("college", "==", college)
                );
            }

            onSnapshot(q, async (snapshot) => {
                if (availableTasksList) {
                    availableTasksList.innerHTML = '';
                    if (snapshot.empty) {
                        availableTasksList.innerHTML = '<p class="text-center text-gray-600">No open tasks available.</p>';
                    } else {
                        for (const docSnapshot of snapshot.docs) {
                            const task = docSnapshot.data();
                            const taskId = docSnapshot.id;
                            let posterName = "Unknown";
                            try {
                                const posterDocRef = doc(db, "users", task.postedByUid);
                                const posterDocSnap = await getDoc(posterDocRef);
                                if (posterDocSnap.exists()) {
                                    posterName = posterDocSnap.data().fullName || "A student";
                                }
                            } catch (error) {
                                console.error("Error fetching poster name:", error);
                            }
                            const taskCard = `
                                <div class="bg-blue-50 p-6 rounded-lg shadow-sm border-l-4 border-purple-400">
                                    <h4 class="text-lg font-semibold text-gray-800">${task.description}</h4>
                                    <p class="text-gray-600">Format: ${task.format}</p>
                                    <p class="text-gray-600">You earn: <span class="font-bold text-green-700">₹${task.workerReceives}</span> (Offer: ₹${task.price})</p>
                                    <p class="text-gray-600">Posted by: ${posterName} from ${task.college}</p>
                                    <p class="text-gray-500 text-sm mt-2">Posted on: ${task.createdAt ? new Date(task.createdAt.toDate()).toLocaleDateString() : 'N/A'}</p>
                                    <button data-task-id="${taskId}" class="accept-task-button mt-4 bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 ease-in-out transform hover:scale-105">
                                        Accept Task
                                    </button>
                                </div>
                            `;
                            availableTasksList.innerHTML += taskCard;
                        }
                        document.querySelectorAll('.accept-task-button').forEach(button => {
                            button.addEventListener('click', async (event) => {
                                const taskId = event.target.dataset.taskId;
                                await acceptTask(taskId);
                            });
                        });
                    }
                }
            }, (error) => {
                console.error("Error fetching available tasks:", error);
                showMessage(`Error loading available tasks: ${error.message}`, "error");
            });
        }
        
        async function acceptTask(taskId) {
            const user = auth.currentUser;
            if (!user) {
                showMessage("You must be logged in to accept a task.", "error");
                return;
            }
            const taskDocRef = doc(db, "tasks", taskId);
            try {
                const taskDocSnap = await getDoc(taskDocRef);
                if (!taskDocSnap.exists() || taskDocSnap.data().status !== 'open') {
                    showMessage("This task is no longer available or has been accepted.", "error");
                    return;
                }
                
                if (taskDocSnap.data().postedByUid === user.uid) {
                     showMessage("You cannot accept your own task.", "error");
                     return;
                }

                await updateDoc(taskDocRef, {
                    status: 'accepted',
                    acceptedByUid: user.uid,
                    acceptedAt: serverTimestamp()
                });
                showMessage("Task accepted successfully! It now appears in your accepted tasks (under Your Journey / Earnings).", "success");
            } catch (error) {
                console.error("Error accepting task:", error);
                showMessage(`Error accepting task: ${error.message}`, "error");
            }
        }
        
        async function completeTask(taskId) {
            const user = auth.currentUser;
            if (!user) {
                showMessage("You must be logged in to complete a task.", "error");
                return;
            }
            const taskDocRef = doc(db, "tasks", taskId);
            
            try {
                const taskDocSnap = await getDoc(taskDocRef);
                const taskData = taskDocSnap.data();

                if (!taskDocSnap.exists() || taskData.status !== 'accepted' || taskData.acceptedByUid !== user.uid) {
                    showMessage("You cannot mark this task as complete.", "error");
                    return;
                }

                await updateDoc(taskDocRef, {
                    status: 'completed',
                    completedAt: serverTimestamp()
                });
                
                const workerUserRef = doc(db, "users", taskData.acceptedByUid);
                const workerDocSnap = await getDoc(workerUserRef);
                if (workerDocSnap.exists()) {
                    const currentBalance = workerDocSnap.data().balance || 0;
                    await updateDoc(workerUserRef, {
                        balance: currentBalance + taskData.workerReceives
                    });
                    showMessage(`Payment of ₹${taskData.workerReceives} processed successfully!`, "success");
                }
            } catch (error) {
                console.error("Error completing task:", error);
                showMessage(`Error completing task: ${error.message}`, "error");
            }
        }
    </script>
</body>
</html>
